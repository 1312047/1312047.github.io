<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>So Sánh Class Method Và Scope | Chinh&#39;s Notes</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Đặt vấn đềTrong một thời gian rất lâu, từ khi mới học đến khi làm những ứng dụng đầu tiên. Tôi luôn cho rằng Scope và và Class Method hoàn toàn giống nhau. Và lý do Scope xuất hiện là để giúp mã nguồn">
<meta name="keywords" content="ruby,rails">
<meta property="og:type" content="article">
<meta property="og:title" content="So Sánh Class Method Và Scope">
<meta property="og:url" content="https:&#x2F;&#x2F;hdchinh.github.io&#x2F;2019&#x2F;06&#x2F;09&#x2F;2019-06-09-luu-y-ngan-gon-ve-scope-va-class-method&#x2F;index.html">
<meta property="og:site_name" content="Chinh&#39;s Notes">
<meta property="og:description" content="Đặt vấn đềTrong một thời gian rất lâu, từ khi mới học đến khi làm những ứng dụng đầu tiên. Tôi luôn cho rằng Scope và và Class Method hoàn toàn giống nhau. Và lý do Scope xuất hiện là để giúp mã nguồn">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2019-11-13T04:07:56.840Z">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Chinh&#39;s Notes" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Chinh&#39;s Notes</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://hdchinh.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-2019-06-09-luu-y-ngan-gon-ve-scope-va-class-method" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/06/09/2019-06-09-luu-y-ngan-gon-ve-scope-va-class-method/" class="article-date">
  <time datetime="2019-06-08T17:00:00.000Z" itemprop="datePublished">2019-06-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/rails-notes/">rails notes</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      So Sánh Class Method Và Scope
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Dat-van-de"><a href="#Dat-van-de" class="headerlink" title="Đặt vấn đề"></a>Đặt vấn đề</h1><p>Trong một thời gian rất lâu, từ khi mới học đến khi làm những ứng dụng đầu tiên. Tôi luôn cho rằng Scope và và Class Method hoàn toàn giống nhau. Và lý do Scope xuất hiện là để giúp mã nguồn ngắn gọn hơn.</p>
<p>Nhưng rõ ràng đấy là một suy nghĩ chưa đúng, dưới đây là điểm cần chú ý về 2 phương thức này.</p>
<h1 id="Luan-ban"><a href="#Luan-ban" class="headerlink" title="Luận bàn"></a>Luận bàn</h1><p>Tôi có 1 scope:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Product</span> &lt; ActiveRecord::Base</span></span><br><span class="line">  scope <span class="symbol">:is_active</span>, -&gt; &#123; where <span class="symbol">is_active:</span> <span class="literal">true</span> &#125;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Lấy các products có thuộc tính is_active là true.</span></span><br></pre></td></tr></table></figure>

<p>Tôi có 1 class method:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Product</span> &lt; ActiveRecord::Base</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">self</span>.<span class="title">is_active</span></span></span><br><span class="line">    where <span class="symbol">is_active:</span> <span class="literal">true</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>2 method này là hoàn toàn tương đương nhau, kết quả trả về cũng vậy. Bây giờ thử 1 ví dụ khác.</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Product</span> &lt; ActiveRecord::Base</span></span><br><span class="line">  <span class="comment"># lấy các products đang active</span></span><br><span class="line">  scope <span class="symbol">:is_active</span>, -&gt; &#123; where <span class="symbol">is_active:</span> <span class="literal">true</span> &#125;</span><br><span class="line">  <span class="comment"># lấy các products có type bằng type được truyền vào scope, và đảm bảo type được truyền vào có giá trị</span></span><br><span class="line">  scope <span class="symbol">:by_type</span>, -&gt; type &#123; where <span class="symbol">type:</span> type <span class="keyword">if</span> type.present? &#125;</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>Viết ví dụ trên dưới dạng Class Method:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Product</span> &lt; ActiveRecord::Base</span></span><br><span class="line">  <span class="comment"># lấy các products đang active</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">self</span>.<span class="title">is_active</span></span></span><br><span class="line">    where <span class="symbol">is_active:</span> <span class="literal">true</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">  <span class="comment"># lấy các products có type bằng type được truyền vào scope và đảm bảo type truyền vào có giá trị</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">self</span>.<span class="title">by_type</span><span class="params">(type)</span></span></span><br><span class="line">    where <span class="symbol">type:</span> type <span class="keyword">if</span> type.present?</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>Tiến hành gọi liên tiếp Scope:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Product.by_type(<span class="literal">nil</span>).is_active</span><br><span class="line"><span class="comment"># truyền vào type không hợp lệ, nhưng scope is_active vẫn work bình thường</span></span><br></pre></td></tr></table></figure>

<p>Tiến hành gọi liên tiếp Class Method:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Product.by_type(<span class="literal">nil</span>).is_active</span><br><span class="line"></span><br><span class="line"><span class="comment"># Trản về một error method is_active không được định nghĩa cho nil.</span></span><br></pre></td></tr></table></figure>

<p>Ủa vậy chuyện này là sao? Tại sao Scope vẫn work bình thường trong khi Class Method lại bắn về một exception?</p>
<p>Đây chính là điểm khác biệt quan trọng của Scopy và Class Method.</p>
<p>Scope luôn luôn trả về một <code>ActiveRecord Relation</code>. Còn Class Method thì sao? Nếu bạn không cover trường hợp <strong>nil/blank</strong> thì nó sẽ văng về <strong>nil/blank</strong> như vậy không thể chạy Class Method phía sau, vì method đó không thể chạy <strong>với nil/blank</strong>. :smile:</p>
<h1 id="Ket-luan"><a href="#Ket-luan" class="headerlink" title="Kết luận"></a>Kết luận</h1><p>Đây là một kết luận sơ sài được tôi rút ra trong quá trình làm việc. Nếu có sai xót hãy để lại bình luận dưới đây.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://hdchinh.github.io/2019/06/09/2019-06-09-luu-y-ngan-gon-ve-scope-va-class-method/" data-id="ck2wvjjar001zgyrz1ga7huil" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/rails/" rel="tag">rails</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ruby/" rel="tag">ruby</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/06/10/2019-06-10-xu-ly-ngoai-le-trong-rails/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Exception Trong Rails
        
      </div>
    </a>
  
  
    <a href="/2019/06/09/2019-06-09-so-sanh-symbol-va-string-trong-ruby/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Symbol Và String Trong Ruby</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Random/">Random</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/he-dieu-hanh/">hệ điều hành</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/rails-notes/">rails notes</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ruby-notes/">ruby notes</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/ruby-notes/programming/">programming</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/til/">til</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/TIl/" rel="tag">TIl</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/activerecord/" rel="tag">activerecord</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/aws/" rel="tag">aws</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/carrierwave/" rel="tag">carrierwave</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/database/" rel="tag">database</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/https/" rel="tag">https</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/orm/" rel="tag">orm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/programming/" rel="tag">programming</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rack/" rel="tag">rack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rails/" rel="tag">rails</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/random/" rel="tag">random</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ruby/" rel="tag">ruby</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/secure/" rel="tag">secure</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/solid/" rel="tag">solid</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/til/" rel="tag">til</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/unix/" rel="tag">unix</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/TIl/" style="font-size: 12px;">TIl</a> <a href="/tags/activerecord/" style="font-size: 10px;">activerecord</a> <a href="/tags/aws/" style="font-size: 12px;">aws</a> <a href="/tags/carrierwave/" style="font-size: 10px;">carrierwave</a> <a href="/tags/database/" style="font-size: 10px;">database</a> <a href="/tags/https/" style="font-size: 10px;">https</a> <a href="/tags/orm/" style="font-size: 10px;">orm</a> <a href="/tags/programming/" style="font-size: 12px;">programming</a> <a href="/tags/rack/" style="font-size: 10px;">rack</a> <a href="/tags/rails/" style="font-size: 18px;">rails</a> <a href="/tags/random/" style="font-size: 10px;">random</a> <a href="/tags/ruby/" style="font-size: 20px;">ruby</a> <a href="/tags/secure/" style="font-size: 16px;">secure</a> <a href="/tags/solid/" style="font-size: 10px;">solid</a> <a href="/tags/til/" style="font-size: 14px;">til</a> <a href="/tags/unix/" style="font-size: 16px;">unix</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/11/12/hello-hexo/">Hello Hexo1!</a>
          </li>
        
          <li>
            <a href="/2019/09/20/2019-09-20-vscode-extension/">My Favourite Vscode Extensions</a>
          </li>
        
          <li>
            <a href="/2019/08/05/2019-08-05-setup-terminal-macos/">Terminal macOS Tricks</a>
          </li>
        
          <li>
            <a href="/2019/06/26/2019-06-25-xay-dung-mot-orm-don-gian-bang-ruby/">A Simple ORM</a>
          </li>
        
          <li>
            <a href="/2019/06/24/2019-06-24-simple-rack-application/">A Simple Rack Application</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 Duy Chinh<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>